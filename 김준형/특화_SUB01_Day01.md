# Docker

Linux 에서는 바로 docker engine 사용 가능 → docker는 Linux 커널 기반으로 개발되었기 때문이다.

docker desktop은 window에서 쉽게 docker 사용 할 수 있도록 해주는 것

---

# 컨테이너

- 컨테이너는 항상 이미지를 기반으로 한다.(컨테이너 실행을 위해서는 먼저 이미지를 생성해야 됨)
- 컨테이너는 이미지의 구체적인 실행 인스턴스이다.
- 즉, 이미지를 기반으로 하는 컨테이너를 실행하는 것이다.
- 컨테이너는 애플리케이션 실행에 필요한 코드, 라이브러리, 설정 파일 등을 하나로 묶어 격리된 환경에서 실행하도록 하는 기술 + OS 커널을 공유합니다.

# 이미지

- 컨테이너의 실행에 필요한 파일 시스템 스냅샷
- 애플리케이션 코드, 라이브러리, 실행 환경 등이 포함된다.
- Dockerfile이라는 스크립트 파일에 명령어를 순차적으로 기술하여 이미지 생성
- run 명령어를 통해 이미지의 인스턴를 만든다 → 컨테이너 생성

# Docker 역할

- **일관된 환경:** 로컬 개발 환경, 테스트 서버, 프로덕션 서버 모두 동일한 환경에서 애플리케이션을 실행
- **경량화:** 전체 운영 체제를 포함하는 VM(Virtual Machine)과 달리 필요한 파일만 포함하여 리소스 사용을 최소화
- **빠른 배포 및 확장:** 컨테이너를 빠르게 시작하고 종료할 수 있어, CI/CD 파이프라인에 유리

# Dockerfile

- FROM
- WORKDIR
    - 모든컨테이너에는 자체 파일 시스템이 있다.
    - docker 컨테이너의 작업 디렉토리 설정
- COPY
    - COPY . /app :  . 과 /app 뜻은?
    - COPY . ./
- EXPOSE
    - 포트를 외부에 노출함
- CMD
    - 이미지를 기반으로 컨테이너가 시작될 때 시작된다.
- ENTRYPOINT

Dockerfile을 기반으로 이미지를 빌드한다. → 이미지 결과물에 대한 ID를 얻는다.

다음 명령어를 통해 컨테이너 실행

```
docker run -p 40000:8080 "이미지 빌드 후 얻은 결과물의 ID"
```

# Docker Volumes

### 개념 및 필요성

- **데이터 유지:**컨테이너는 기본적으로 휘발성이므로, 데이터 지속성을 위해 호스트와 데이터를 공유할 필요가 있음.
- **활용 사례:**
    - 데이터베이스 컨테이너의 데이터 저장
    - 로그 파일 저장 및 분석

# Docker Compose로 다중 컨테이너 관리

### Docker Compose란?

- **정의:**여러 컨테이너를 하나의 YAML 파일(`docker-compose.yml`)로 정의하고, 함께 실행할 수 있는 도구입니다.
- **장점:**
    - 복잡한 애플리케이션 스택을 손쉽게 정의
    - 환경 구성 및 서비스 간 의존성 관리 용이

# healthcheck

### Healthcheck의 목적

- **서비스 가용성 확인:**컨테이너 내 애플리케이션이 단순히 실행 중인지가 아니라, 실제로 정상적으로 동작하는지를 확인합니다.
- **문제 조기 탐지:**애플리케이션에 문제가 발생하면 이를 빠르게 감지하여, 재시작 또는 장애 복구를 위한 조치를 취할 수 있도록 도와줍니다.

### **오케스트레이션과의 연계**

Docker Swarm이나 Kubernetes와 같이 컨테이너 오케스트레이션 도구에서는 healthcheck 결과를 바탕으로 컨테이너를 재시작하거나, 서비스 트래픽을 조절할 수 있습니다.

### **`depends_on` 옵션에 `condition: service_healthy` 추가**

의존하는 서비스(예: 데이터베이스)가 healthcheck를 통해 

healthy 상태가 될 때까지 대기한 후, 그 다음에 의존하는 서비스(예: 웹 애플리케이션)를 시작합니다.

# 가상머신 vs Docker 컨테이너

## 왜 컨테이너가 가벼울까?

1. **사용자의 OS 커널 공유**
    - 중복 실행 제거
    - 성능 저하 없이 자원 효율 극대화
2. **최소한의 사용자 공간**
    - 앱 실행에 필요한 라이브러리 + 도구 모음
    - 앱 실행에 필요한 최소한의 요소만 담아 효율성과 안전성을 동시에 추구하는 기술